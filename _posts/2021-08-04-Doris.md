---
title: 'OLAP数据库 Doris '
layout: post
tags:
  - ntpdate 
category: Doris 
---
OLAP数据库 Doris  安装和使用。

<!--more-->

# 一、编译doris

## docker安装编译环境

```
docker pull apache/incubator-doris:build-env-1.2

docker run -it -v /usr/local/.m2:/root/.m2 -v /home/mydoris:/root/mydoris/ apache/incubator-doris:build-env-1.2
```

## 下载doris源码

```
git clone https://github.com/apache/incubator-doris.git

wget https://dist.apache.org/repos/dist/dev/incubator/doris/0.14/0.14.0-rc06/apache-doris-0.14.0-incubating-src.tar.gz
```

## 执行编译

```
WITH_MYSQL=1 WITH_LZO=1 sh build.sh
```



# 二、fe端安装

## Dockfile_fe

```dockerfile
FROM centos:centos7.5.1804

RUN mkdir /home/doris/run/ -p

# copy jdk and doris binary
COPY jdk1.8.0_291/ /home/doris/run/jdk1.8.0_291/
COPY fe/ /home/doris/run/fe/

# set java home
ENV JAVA_HOME /home/doris/run/jdk1.8.0_291/
ENV JRE_HOME=${JAVA_HOME}/jre
ENV CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib
ENV PATH=${JAVA_HOME}/bin:$PATH
ENV DORIS_HOME /home/doris/run

# set fe port: http/thrift/mysql/bdbje
EXPOSE 8030 9020 9030 9010 9060 9070 8040 9050

# fe log and meta-data
VOLUME ["/home/doris/run/fe/conf","/home/doris/run/fe/log","/home/doris/run/fe/doris-meta"]

WORKDIR /home/doris/run/fe/

# 因为两点：1、最好把所有配置项都配置好再启动；2、为了能进容器修改配置，所以需要使启动容器后容器不立马退出，所以配置了一个能一直运行的命令
CMD ["tail", "-f", "/dev/null"]
```

## 构建镜像

```
docker build -t doris-fe:0.14 -f Dockerfile_fe .
```

## 创建容器并启动

```
docker create -it --name fe1 --net=host -v /home/doris/run/fe1/conf:/home/doris/run/fe/conf -v /home/doris/run/fe1/log:/home/doris/run/fe/log -v /home/doris/run/fe1/doris-meta:/home/doris/run/fe/doris-meta doris-fe:0.14 tail -f /dev/null

docker start

docker exec -it 容器ID /bin/bash
```

## 修改配置

路径：conf/fe.conf

将 priority_networks项配置为 ip/掩码位数

```
priority_networks = 192.168.101.132/24
```

## 启动命令

路径：bin

```
sh start_fe.sh --daemon
```

## 查看启动状况

```
jps
```

## web端查看

http://192.168.101.132:8030/variable

# 三、be端安装

## Dockerfile_be

```dockerfile
FROM centos:centos7.5.1804

RUN  mkdir -p /home/doris/run/

RUN yum -y update \
 && yum install -y binutils-devel \
 && yum -y clean all \
 && rm -rf /var/cache/yum

# copy be
COPY be/ /home/doris/run/be/

# set be port: thrift/rpc/http/heartbeat
# 前四位是fe，后四位是be
EXPOSE 8030 9020 9030 9010 9060 9070 8040 9050
 
# be log,conf and data
VOLUME ["/home/doris/run/be/conf", "/home/doris/run/be/log", "/home/doris/run/be/data/","/home/doris/run/be/storage/"]

WORKDIR /home/doris/run/be/
RUN ldd lib/palo_be

CMD ["tail", "-f", "/dev/null"]
```

## 构建镜像

```
docker build -t doris-be -f Dockerfile_be .

docker create -it --name be1 --net=host --ulimit nofile=65535:65535 -v /home/doris/run/be1/conf:/home/doris/run/be/conf -v /home/doris/run/be1/log:/home/doris/run/be/log -v /home/doris/run/be1/data:/home/doris/run/be/data -v /home/doris/run/be1/storage:/home/doris/run/be/storage doris-be:0.14 tail -f /dev/null
```

## 修改配置

路径：conf/fe.conf

将 priority_networks项配置为 ip/掩码位数

```
priority_networks = 192.168.101.132/24
```

## 启动命令

路径：bin

```
sh start_fe.sh --daemon
```

# 四、常用命令

## sql

默认用户名密码

| 用户名 | 密码 |
| ------ | ---- |
| root   |      |



```mysql
-- 连接
mysql -h 192.168.101.132 -P9030 -uroot

-- 增加节点
ALTER SYSTEM ADD BACKEND "192.168.101.133:9050";
ALTER SYSTEM ADD BACKEND "192.168.101.134:9050";

-- 查看节点，可以看到全部端口则表示连接成功
SHOW PROC '/backends';

-- 关闭节点并删除节点
alter system decommission backend '192.168.101.134:9050';
alter system dropp backend '192.168.101.134:9050';
```

## stream upload

```
curl --location-trusted -u root -H "label:1" -H "column_separator:," -T test2.csv http://192.168.101.132:8030/api/test/detail/_stream_load
```

